var ClassUtil=(function(){function a(){}a.prototype={extend:function(d,c){var b;b={};this.extendPrototype(b,c.prototype);this.extendPrototype(b,d.prototype);b.constructor=d;d.prototype=b},extendPrototype:function(e,c){var f,b,g;for(var d in c){if(c.hasOwnProperty(d)){f=Object.getOwnPropertyDescriptor(c,d);b=f.get;g=f.set;if(b||g){Object.defineProperty(e,d,{get:b,set:g,enumerable:true})}else{e[d]=c[d]}}}},getGetterAndOrSetter:function(e,b,f){var c,d;c={};c.enumerable=true;d=e[0].toUpperCase()+e.substring(1);if(b){c.get=function(){return this["get"+d]()}}if(f){c.set=function(g){return this["set"+d](g)}}return c},defineGetterAndSetter:function(b,c){Object.defineProperty(b.prototype,c,this.getGetterAndOrSetter(c,true,true))},defineGetter:function(b,c){Object.defineProperty(b.prototype,c,this.getGetterAndOrSetter(c,true,false))},defineSetter:function(b,c){Object.defineProperty(b.prototype,c,this.getGetterAndOrSetter(c,false,true))}};return new a()}());var BasePatternGrid=(function(){function a(){this.$elem;this.width;this.height;this.pattern;this.$canvas}a.prototype={preparePattern:function(){},correctWidthAndHeight:function(){},setupContext:function(b){b.lineWidth=1;b.strokeStyle="#000000";b.globalAlpha=0.15},attachTo:function(b){var c,d,e;this.$elem=b;this.width=this.$elem.width();this.height=this.$elem.height();this.correctWidthAndHeight();this.pattern=$("<canvas/>")[0];this.preparePattern();this.$canvas=$("<canvas/>");this.$canvas.addClass("layer");c=this.$canvas[0];c.width=this.width;c.height=this.height;d=c.getContext("2d");e=d.createPattern(this.pattern,"repeat");d.fillStyle=e;d.rect(0,0,this.width,this.height);d.fill();this.$elem.before(this.$canvas);return this.$canvas},detach:function(){this.$canvas.remove()},snapPosition:function(b){return b}};return a}());var SquarePatternGrid=(function(){var b=BasePatternGrid;function a(c){this.size=c||25}a.prototype={preparePattern:function(){b.prototype.preparePattern.call(this);var c;this.pattern.width=this.size;this.pattern.height=this.size;c=this.pattern.getContext("2d");c.save();this.setupContext(c);c.beginPath();c.moveTo(0,this.size);c.lineTo(0,0);c.lineTo(this.size,0);c.stroke();c.restore()},snapPosition:function(e){e=b.prototype.snapPosition.call(this,e);var c,d;c=e.x;d=e.y;c=this.size*Math.round(c/this.size);d=this.size*Math.round(d/this.size);e.x=c;e.y=d;return e}};ClassUtil.extend(a,b);return a}());var LinePatternGrid=(function(){var a=BasePatternGrid;function b(c){this.size=c||50}b.prototype={correctWidthAndHeight:function(){a.prototype.correctWidthAndHeight.call(this);this.height=this.size*Math.floor(this.height/this.size)},preparePattern:function(){a.prototype.preparePattern.call(this);var c;this.pattern.width=1;this.pattern.height=this.size;c=this.pattern.getContext("2d");c.save();this.setupContext(c);c.beginPath();c.moveTo(0,0);c.lineTo(1,0);c.stroke();c.restore()}};ClassUtil.extend(b,a);return b}());var Mesh1PatternGrid=(function(){var a=BasePatternGrid;function b(c){this.size=c||50}b.prototype={preparePattern:function(){a.prototype.preparePattern.call(this);var c;this.pattern.width=this.size;this.pattern.height=this.size;c=this.pattern.getContext("2d");c.save();this.setupContext(c);c.beginPath();c.moveTo(this.size,this.size);c.lineTo(0,0);c.lineTo(this.size,0);c.lineTo(0,this.size);c.lineTo(0,0);c.stroke();c.restore()},snapPosition:function(j){j=a.prototype.snapPosition.call(this,j);var c,i,h,f,e,d,g;c=j.x;i=j.y;h=this.size*Math.floor(c/this.size);f=this.size*Math.floor(i/this.size);e=(c-h)/this.size;d=(i-f)/this.size;g=Math.floor((e+d)*2);if(g===0){c=h;i=f}else{if(g===3){c=h+this.size;i=f+this.size}else{g=Math.floor(((1-e)+d)*2);if(g===0){c=h+this.size;i=f}else{if(g===3){c=h;i=f+this.size}else{c=h+(this.size/2);i=f+(this.size/2)}}}}j.x=c;j.y=i;return j}};ClassUtil.extend(b,a);return b}());var Mesh2PatternGrid=(function(){var a=BasePatternGrid;function b(c){this.size=c||50;this.meshWidth;this.meshHeight}b.prototype={calculateMeshWidth:function(){return 2*this.size*Math.round(Math.sqrt(3)/2)},preparePattern:function(){a.prototype.preparePattern.call(this);var c,d;this.meshWidth=this.calculateMeshWidth();this.meshHeight=this.size;this.pattern.width=this.meshWidth;this.pattern.height=this.meshHeight;c=this.pattern.getContext("2d");c.save();this.setupContext(c);c.beginPath();c.moveTo(this.meshWidth,0);c.lineTo(0,this.meshHeight);c.lineTo(0,0);c.lineTo(this.meshWidth,this.meshHeight);c.moveTo(0,0);c.lineTo(0,this.meshHeight);d=this.meshWidth/2;c.moveTo(d,0);c.lineTo(d,this.meshHeight);c.stroke();c.restore()},snapPosition:function(j){j=a.prototype.snapPosition.call(this,j);var c,i,h,f,e,d,g;c=j.x;i=j.y;h=this.meshWidth*Math.floor(c/this.meshWidth);f=this.meshHeight*Math.floor(i/this.meshHeight);e=(c-h)/this.meshWidth;d=(i-f)/this.meshHeight;g=Math.floor((e+d)*2);if(g===0){c=h;i=f}else{if(g===3){c=h+this.meshWidth;i=f+this.meshHeight}else{g=Math.floor(((1-e)+d)*2);if(g===0){c=h+this.meshWidth;i=f}else{if(g===3){c=h;i=f+this.meshHeight}else{c=h+(this.meshWidth/2);i=f+(this.meshHeight/2)}}}}j.x=c;j.y=i;return j}};ClassUtil.extend(b,a);return b}());var MusicPatternGrid=(function(){var a=BasePatternGrid;function b(e,d,c){this.lineHeight=e||20;this.topGap=d||70;this.bottomGap=c||30;this.fullHeight=this.topGap+this.bottomGap+(4*this.lineHeight)}b.prototype={correctWidthAndHeight:function(){a.prototype.correctWidthAndHeight.call(this);this.height=this.fullHeight*Math.floor(this.height/this.fullHeight)},preparePattern:function(){a.prototype.preparePattern.call(this);var e,c;this.pattern.width=1;this.pattern.height=this.fullHeight;e=this.pattern.getContext("2d");e.save();this.setupContext(e);e.beginPath();for(var d=0;d<5;++d){c=this.topGap+(d*this.lineHeight);e.moveTo(0,c);e.lineTo(1,c)}e.stroke();e.restore()}};ClassUtil.extend(b,a);return b}());var WritingPatternGrid=(function(){var a=BasePatternGrid;function b(e,f,d,c){this.lineHeight=e||20;this.horizontalSpan=f||30;this.topGap=d||70;this.bottomGap=c||30;this.fullHeight=this.topGap+this.bottomGap+(3*this.lineHeight)}b.prototype={correctWidthAndHeight:function(){a.prototype.correctWidthAndHeight.call(this);this.height=this.fullHeight*Math.floor(this.height/this.fullHeight)},preparePattern:function(){a.prototype.preparePattern.call(this);var e,c;this.pattern.width=this.horizontalSpan;this.pattern.height=this.fullHeight;e=this.pattern.getContext("2d");e.save();this.setupContext(e);e.beginPath();for(var d=0;d<4;++d){c=this.topGap+(d*this.lineHeight);e.moveTo(0,c);e.lineTo(this.horizontalSpan,c);if(d===3){e.moveTo(0,c);e.lineTo(this.horizontalSpan,this.topGap)}}e.stroke();e.restore()}};ClassUtil.extend(b,a);return b}());